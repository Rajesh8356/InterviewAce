<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Our Community</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 90%;
            max-width: 1200px;
            height: 600px;
            display: flex;
        }

        .image-section {
            flex: 1;
            background: linear-gradient(45deg, #3498db, #8e44ad);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            opacity: 0.7;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        .quote {
            color: white;
            font-size: 1.5rem;
            text-align: center;
            max-width: 80%;
            z-index: 10;
            opacity: 0;
            animation: fadeIn 2s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .form-section {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        .input-group {
            margin-bottom: 1rem;
            position: relative;
        }

        label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            transition: 0.3s ease all;
            pointer-events: none;
        }

        input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 1rem;
            transition: 0.3s ease all;
        }

        input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        input:focus + label, input:not(:placeholder-shown) + label {
            top: 0;
            font-size: 0.8rem;
            background: white;
            padding: 0 5px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s ease all;
        }

        button:hover {
            background: #2980b9;
        }

        .login-link {
            text-align: center;
            margin-top: 1rem;
            color: #7f8c8d;
        }

        .login-link a {
            color: #3498db;
            text-decoration: none;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 0.2rem;
            display: none;
        }

        .success-message {
            color: #2ecc71;
            font-size: 0.9rem;
            margin-top: 0.2rem;
            display: none;
        }
        
        /* New styles for verification */
        .email-verified {
            position: relative;
        }
        
        .email-verified::after {
            content: "âœ“";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #2ecc71;
            font-weight: bold;
        }
        
        .verify-email-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 0.5rem;
            display: none;
        }
        
        .verify-email-btn:hover {
            background: #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="image-section">
            <div class="floating-shapes">
                <svg class="shape" style="left: 10%; top: 20%;" width="50" height="50" viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="#fff" fill-opacity="0.5" />
                </svg>
                <svg class="shape" style="left: 60%; top: 60%;" width="60" height="60" viewBox="0 0 60 60">
                    <rect width="40" height="40" x="10" y="10" fill="#fff" fill-opacity="0.5" />
                </svg>
                <svg class="shape" style="left: 80%; top: 10%;" width="40" height="40" viewBox="0 0 40 40">
                    <polygon points="20,0 40,40 0,40" fill="#fff" fill-opacity="0.5" />
                </svg>
            </div>
            <div class="quote">
                "Welcome to the registration page"
            </div>
        </div>
        <div class="form-section">
            <h1>Create Your Account</h1>
            <form id="registrationForm" action="/register" method="post" onsubmit="return validateForm()">
                <div class="input-group">
                    <input type="text" id="name" name="name" required placeholder=" ">
                    <label for="name">Full Name</label>
                </div>
                
                <div class="input-group" id="emailGroup">
                    <input type="email" id="email" name="email" required placeholder=" " onblur="checkEmailExists()">
                    <label for="email">Email Address</label>
                    <div id="emailError" class="error-message"></div>
                    <button type="button" id="verifyEmailBtn" class="verify-email-btn" onclick="sendVerificationCode()">Verify Email</button>
                </div>

                <div class="input-group">
                    <input type="text" id="phone" name="phone" required placeholder=" ">
                    <label for="phone">Phone Number</label>
                    <div id="phoneError" class="error-message"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="password" name="password" required placeholder=" ">
                    <label for="password">Password</label>
                </div>

                <button type="submit" id="submitButton">Sign Up</button>
            </form>
            <p class="login-link">Already have an account? <a href="/login">Log in</a></p>
        </div>
    </div>
    
    <!-- Verification Modal -->
    <div id="verificationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2>Verify Your Email</h2>
            <p>We've sent a 4-digit code to your email. Please enter it below.</p>
            
            <div class="input-group">
                <input type="text" id="verificationCode" name="verificationCode" placeholder=" " maxlength="4">
                <label for="verificationCode">Verification Code</label>
                <div id="codeError" class="error-message"></div>
            </div>
            
            <div id="timer" style="color: #e74c3c; margin: 1rem 0;">
                Time remaining: 01:00
            </div>
            
            <div style="display: flex; justify-content: space-between;">
                <button type="button" onclick="resendCode()" id="resendBtn" disabled style="background: #95a5a6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: not-allowed;">
                    Resend Code (60s)
                </button>
                <button type="button" onclick="verifyCode()" style="background: #3498db; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                    Verify
                </button>
            </div>
            
            <button type="button" onclick="closeVerificationModal()" style="background: none; border: none; color: #7f8c8d; position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 1.5rem;">
                &times;
            </button>
        </div>
    </div>
    
    <script>
    // Global variables
    let verificationTimer;
    let timeLeft = 60;
    let verificationCode = '';
    let emailToVerify = '';
    
    function validateForm() {
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    const name = document.getElementById('name').value.trim();
    const password = document.getElementById('password').value.trim();
    const phoneError = document.getElementById('phoneError');
    const emailError = document.getElementById('emailError');
    
    // Reset errors
    phoneError.textContent = "";
    phoneError.style.display = "none";
    emailError.textContent = "";
    emailError.style.display = "none";

    let isValid = true;

    // Check if email is verified
    const emailInput = document.getElementById('email');
    if (!emailInput.classList.contains('email-verified')) {
        emailError.textContent = "Please verify your email first";
        emailError.style.display = "block";
        isValid = false;
    }

    // Basic validation
    if (!name) {
        alert("Please enter your full name");
        isValid = false;
    }

    if (!email) {
        alert("Please enter your email address");
        isValid = false;
    }

    if (!phone) {
        alert("Please enter your phone number");
        isValid = false;
    }

    if (!password) {
        alert("Please enter a password");
        isValid = false;
    }

    // Phone validation: 10 digits only
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!phoneRegex.test(phone)) {
        phoneError.textContent = "Enter a valid 10-digit phone number starting with 6-9.";
        phoneError.style.display = "block";
        isValid = false;
    }

    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        emailError.textContent = "Enter a valid email address.";
        emailError.style.display = "block";
        isValid = false;
    }

    return isValid;
}

    // Check if email already exists
    function checkEmailExists() {
        const email = document.getElementById('email').value.trim();
        const emailError = document.getElementById('emailError');
        const verifyBtn = document.getElementById('verifyEmailBtn');
        
        if (!email) return;
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            return;
        }
        
        fetch(`/check-email?email=${encodeURIComponent(email)}`)
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    emailError.textContent = "This email is already registered";
                    emailError.style.display = "block";
                    verifyBtn.style.display = "none";
                } else {
                    emailError.style.display = "none";
                    verifyBtn.style.display = "block";
                }
            })
            .catch(error => {
                console.error('Error checking email:', error);
            });
    }
    
    // Function to send verification code
    function sendVerificationCode() {
        const email = document.getElementById('email').value.trim();
        const emailError = document.getElementById('emailError');
        
        if (!email) {
            emailError.textContent = "Please enter an email address first";
            emailError.style.display = "block";
            return;
        }
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailError.textContent = "Please enter a valid email address";
            emailError.style.display = "block";
            return;
        }
        
        emailToVerify = email;
        
        // Show verification modal
        document.getElementById('verificationModal').style.display = 'block';
        
        // Generate a random 4-digit code
        verificationCode = Math.floor(1000 + Math.random() * 9000).toString();
        
        // Start the timer
        startTimer();
        
        // Make an API call to your backend to send the email
        fetch('/send-verification-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                code: verificationCode
            })
        })
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                alert('Failed to send verification code. Please try again.');
                if (data.error === 'Email already registered') {
                    emailError.textContent = "This email is already registered";
                    emailError.style.display = "block";
                    document.getElementById('verifyEmailBtn').style.display = "none";
                    closeVerificationModal();
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to send verification code. Please try again.');
        });
    }
    
    // Function to start the timer
    function startTimer() {
        timeLeft = 60;
        updateTimerDisplay();
        document.getElementById('resendBtn').disabled = true;
        document.getElementById('resendBtn').style.cursor = 'not-allowed';
        document.getElementById('resendBtn').style.background = '#95a5a6';
        
        verificationTimer = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(verificationTimer);
                document.getElementById('resendBtn').disabled = false;
                document.getElementById('resendBtn').style.cursor = 'pointer';
                document.getElementById('resendBtn').style.background = '#3498db';
                document.getElementById('resendBtn').textContent = 'Resend Code';
            }
        }, 1000);
    }
    
    // Update timer display
    function updateTimerDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timer').textContent = `Time remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft > 0) {
            document.getElementById('resendBtn').textContent = `Resend Code (${timeLeft}s)`;
        }
    }
    
    // Function to resend verification code
    function resendCode() {
        if (timeLeft > 0) return;
        
        sendVerificationCode();
    }
    
    function verifyCode() {
    const enteredCode = document.getElementById('verificationCode').value.trim();
    const codeError = document.getElementById('codeError');

    fetch('/verify-email-code', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            email: emailToVerify,
            code: enteredCode
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            codeError.style.display = "none";
            const emailInput = document.getElementById('email');
            emailInput.classList.add('email-verified');
            document.getElementById('verifyEmailBtn').style.display = 'none';
            closeVerificationModal();
            clearInterval(verificationTimer);
            alert("âœ… Email verified successfully!");
        } else {
            codeError.textContent = "Invalid verification code";
            codeError.style.display = "block";
        }
    })
    .catch(err => {
        console.error("Error verifying code:", err);
        codeError.textContent = "Server error. Please try again.";
        codeError.style.display = "block";
    });
}

    // Close verification modal
    function closeVerificationModal() {
        document.getElementById('verificationModal').style.display = 'none';
        document.getElementById('verificationCode').value = '';
        document.getElementById('codeError').style.display = 'none';
        clearInterval(verificationTimer);
    }
    
    // Clear timer when page is unloaded
    window.addEventListener('beforeunload', () => {
        if (verificationTimer) {
            clearInterval(verificationTimer);
        }
    });
</script>
</body>
</html>